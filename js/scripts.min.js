var Background=function(a,b){"undefined"==typeof b&&(b="grass"),a.stage.backgroundColor="#d0f4f7",this.cloudsSecond=a.add.tileSprite(0,a.height-320,967,177,"bg_clouds_2"),this.cloudsSecond.autoScroll(-20,0),this.cloudsFirst=a.add.tileSprite(-200,a.height-250,967,177,"bg_clouds_1"),this.cloudsFirst.autoScroll(-40,0),this.front=a.add.tileSprite(0,a.height-264,967,264,"bg_"+b)};Background.prototype=Object.create(Phaser.Group.prototype),Background.prototype.constructor=Background,Background.prototype.scroll=function(a){this.front.autoScroll(a,0)},Background.prototype.scrollClouds=function(a,b){this.cloudsFirst.autoScroll(a,0),this.cloudsSecond.autoScroll(b,0)},Background.prototype.change=function(a){this.front.loadTexture("bg_"+a);var b=this;setTimeout(function(){b.front.loadTexture("bg_"+a)},25)};var Enemies=function(a){Phaser.Group.call(this,a,a.world,"Enemies",!1,!0,Phaser.Physics.ARCADE),this.nextSpawn=0,this.minSpawnRate=1e3,this.maxSpawnRate=1800,this.minSpeed=200,this.maxSpeed=400,this.spawnSpeed=0,this.spawnRate=0,this.spawnX=0,this.direction="left";var b=0;for(b;2>b;b++)this.add(new Mouse(a)),this.add(new Bee(a)),this.add(new Fly(a)),this.add(new Ladybug(a));return this};Enemies.prototype=Object.create(Phaser.Group.prototype),Enemies.prototype.constructor=Enemies,Enemies.prototype.spawn=function(){this.game.time.time<this.nextSpawn||(this.children.sort(function(){return.5-Math.random()}),this.spawnSpeed=game.rnd.integerInRange(this.minSpeed,this.maxSpeed),this.spawnRate=game.rnd.integerInRange(this.minSpawnRate,this.maxSpawnRate),this.fromSide="random"===this.direction?game.rnd.pick(["left","right"]):this.direction,"left"===this.fromSide?(this.spawnSpeed*=-1,this.spawnX=game.width+24):"right"===this.fromSide&&(this.fromSide="right",this.spawnX=0),this.getFirstExists(!1).spawn(this.spawnX,this.spawnSpeed,this.fromSide),this.nextSpawn=game.time.time+this.spawnRate)},Enemies.prototype.stop=function(){this.forEach(function(a){a.stop()})},Enemies.prototype.countOnScreen=function(){var a=0;return this.forEach(function(b){b.exists&&a++}),a};var Enemy=function(){this.direction="left"};Enemy.prototype=Object.create(Phaser.Sprite.prototype),Enemy.prototype.constructor=Enemy,Enemy.prototype.create=function(a,b){Phaser.Sprite.call(this,a,0,0,"sprites",b+".png"),a.physics.arcade.enable(this),this.anchor.set(.5,1),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.exists=!1,this.body.allowGravity=!1,this.animations.add("move",[b+".png",b+"_move.png"],5,!0),this.animations.play("move")},Enemy.prototype.stop=function(){this.body.velocity.x=0,this.body.moves=!1,this.animations.stop()},Enemy.prototype.spawn=function(a,b,c){c!==this.direction&&(this.direction=c,this.scale.x*=-1),this.reset(a,this.posY),this.hasScored=!1,this.body.velocity.x=b},Enemy.prototype.checkScore=function(a){return!this.exists||this.hasScored?!1:"left"===this.direction&&this.world.x<=a.world.x?!0:"right"===this.direction&&this.world.x>=a.world.x?!0:void 0};var Ground=function(a,b){"undefined"==typeof b&&(b="grass"),Phaser.TileSprite.call(this,a,0,a.height-48,480,48,"ground_"+b),this.physicsType=Phaser.SPRITE,a.physics.arcade.enableBody(this),this.body.allowGravity=!1,this.body.immovable=!0,a.world.add(this)};Ground.prototype=Object.create(Phaser.TileSprite.prototype),Ground.prototype.constructor=Ground,Ground.prototype.scroll=function(a){this.autoScroll(a,0)},Ground.prototype.change=function(a){this.loadTexture("ground_"+a);var b=this;setTimeout(function(){b.loadTexture("bg_"+a)},25)};var Board=function(a,b){this.config=b,this.score=0,this.scoreTxt="",this.scoreField="Score:",this.best=0,this.bestTxt="",this.bestField="Best:",this.board=a.add.group();var c=a.add.image(.5*a.width-110,100,"board");this.board.add(c);var d=a.add.button(a.width-75,130,"sprites",this.menuClick,this,"menu_btn.png","menu_btn.png","menu_btn_hover.png");d.anchor.set(.5),d.input.useHandCursor=!0,this.board.add(d);var e=a.add.button(a.width-75,190,"sprites",this.repeatClick,this,"repeat_btn.png","repeat_btn.png","repeat_btn_hover.png");e.anchor.set(.5),e.input.useHandCursor=!0,this.board.add(e);this.scoreText=a.add.bitmapText(a.width/2,120,"font","0",22),this.scoreField=a.add.image(.5*a.width-100,120,"score"),this.bestText=a.add.bitmapText(a.width/2,180,"font","0",22),this.bestField=a.add.image(.5*a.width-100,180,"best"),this.board.add(this.scoreText),this.board.add(this.scoreField),this.board.add(this.bestText),this.board.add(this.bestField),this.board.alpha=0,this.board.y=a.height};Board.prototype.menuClick=function(){game.state.start("Menu",!0,!1,this.config)},Board.prototype.repeatClick=function(){game.state.start("Game",!0,!1,this.config)},Board.prototype.show=function(a,b){this.scoreText.text=a.toString(),this.bestText.text=b.toString(),game.add.tween(this.board).to({alpha:1,y:0},500,Phaser.Easing.Exponential.Out,!0,0)};var Player=function(a,b,c,d,e,f){this.playerType=e,this.typesArr=["blue","beige","green","pink","yellow"],this.alive=!0,this.allowJump=!1,this.doubleJump=!0,this.jumpHeight=500,this.tweenInProgress=!1,this.jumpSound=a.add.audio("jump"),this.doublejumpSound=a.add.audio("doublejump"),"undefined"==typeof f&&(f="walk_2"),Phaser.Sprite.call(this,a,b,c,d,e+"_"+f+".png"),a.physics.arcade.enable(this),this.anchor.set(.5,.5),this.body.bounce.y=0,this.body.gravity.y=500,this.addAnimations(e),a.world.add(this)};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player,Player.prototype.onGround=function(){return this.body.blocked.down||this.body.touching.down},Player.prototype.jump=function(){this.alive&&this.allowJump&&(this.onGround()||!this.onGround()&&this.doubleJump)&&(this.animations.stop(),this.frameName=this.playerType+"_jump.png",this.onGround()?(this.body.velocity.y=-this.jumpHeight,this.jumpSound.play()):(this.doubleJump=!1,this.body.velocity.y=-(.75*this.jumpHeight),this.doublejumpSound.play()))},Player.prototype.run=function(){this.onGround()&&this.alive&&(this.doubleJump=!0,this.play("runRight"))},Player.prototype.hitEnemy=function(){this.alive=!1,this.animations.stop(),this.frameName=this.playerType+"_hit.png",this.body.gravity.y=0,this.body.moves=!1},Player.prototype.addAnimations=function(a){this.animations.add("runRight",[a+"_walk_1.png",a+"_walk_2.png"],10,!0),this.animations.add("stand",[a+"_front.png",a+"_stand_right.png",a+"_front.png",a+"_stand_left.png"],.75,!0)};var Bee=function(a){this.posY=a.height-72,this.create(a,"bee")};Bee.prototype=new Enemy,Bee.prototype.constructor=Bee;var Fly=function(a){this.posY=a.height-72,this.create(a,"fly")};Fly.prototype=new Enemy,Fly.prototype.constructor=Fly,Fly.prototype.update=function(){game.time.events.repeat(25,100,function(){this.body.velocity.y=50*Math.sin(game.time.now)},this)};var Ladybug=function(a){this.posY=a.height-48,this.create(a,"ladybug")};Ladybug.prototype=new Enemy(game),Ladybug.prototype.constructor=Ladybug;var Mouse=function(a){this.posY=a.height-48,this.create(a,"mouse")};Mouse.prototype=new Enemy(game),Mouse.prototype.constructor=Mouse;var BasicGame={};BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0},preload:function(){this.load.atlas("preloader","res/preloader.png","res/preloader.json")},create:function(){this.stage.backgroundColor="#F5F5F5",this.state.start("Preload")}},BasicGame.Game=function(a){this.player=null,this.ground=null,this.enemies=null,this.board=null,this.spawn=!1,this.music=null,this.hitSound=null,this.score=0,this.scoreText="",this.bestScore=0,this.timer=null,this.spawnDelay=1e3,this.firstPlay=!0,this.phase=1},BasicGame.Game.prototype={init:function(a){this.config=a,game.renderer.renderSession.roundPixels=!0,this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.gravity.y=800},create:function(){this.music=game.add.audio("music"),this.music.play(),this.music.volume=.75,this.hitSound=game.add.audio("hit"),this.bg=new Background(game,this.config.bgType),this.bg.scroll(-50),this.ground=new Ground(game,this.config.bgType),this.ground.scroll(-150),this.player=new Player(game,-20,game.height-74,"sprites",this.config.playerType);var a=this.add.tween(this.player).to({x:48},500,Phaser.Easing.Default,!0);a.onComplete.add(function(){this.player.allowJump=!0,this.timer.start()},this),this.enemies=new Enemies(game),this.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);var b=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);if(b.onDown.add(this.player.jump,this.player),this.input.onDown.add(this.player.jump,this.player),this.scoreText=this.add.bitmapText(.5*game.width,5,"font","0",22),this.timer=new Phaser.Timer(game),this.timer.add(this.spawnDelay,function(){this.spawn=!0,this.firstPlay=!1,this.infoText.destroy()},this),this.board=new Board(game,this.config),this.firstPlay){var c={font:"20px Verdana",fill:"#FBFBFB",stroke:"#424242",strokeThickness:2};this.infoText=this.game.add.text(.5*game.width,.5*game.height,"Click to Jump",c),this.infoText.anchor.set(.5)}},update:function(){this.physics.arcade.collide(this.player,this.ground),this.physics.arcade.collide(this.player,this.enemies,this.die,null,this),this.player.run(),this.spawn?(this.enemies.spawn(),this.enemies.forEach(function(a){a.checkScore(this.player)&&(a.hasScored=!0,this.score++,this.scoreText.text=this.score.toString())},this)):this.timer.update(game.time.time),this.score>=10&&1===this.phase&&this.player.onGround()&&this.moveToNextPhase(2),this.score>=20&&2===this.phase&&this.player.onGround()&&this.moveToNextPhase(3)},shutdown:function(){this.player=null,this.ground=null,this.enemies=null,this.board=null,this.spawn=!1,this.score=0,this.timer=null,this.phase=1,this.music.stop()},die:function(a,b){this.hitSound.play(),this.spawn=!1,this.physics.arcade.gravity.y=0,this.ground.scroll(0),this.bg.scroll(0),a.hitEnemy(),this.enemies.stop(),this.score>this.bestScore&&(this.bestScore=this.score),this.board.show(this.score,this.bestScore)},moveToNextPhase:function(a){0===this.enemies.countOnScreen()&&(this.spawn=!1,this.player.allowJump=!1,2===a?this.phaseTwo():3===a&&this.phaseThree())},phaseTwo:function(){this.bg.scroll(-100),this.bg.scrollClouds(-60,-40),this.ground.scroll(-200);var a=game.width-48;this.player.x<a?game.physics.arcade.moveToXY(this.player,a,this.player.y,150):(this.phase=2,this.player.body.velocity.x=0,this.player.allowJump=!0,this.bg.scroll(-50),this.bg.scrollClouds(-40,-20),this.ground.scroll(-150),this.spawn=!0,this.enemies.direction="right")},phaseThree:function(){this.bg.scroll(-25),this.bg.scrollClouds(-30,-10),this.ground.scroll(-100);var a=game.width/2;this.player.x>a?game.physics.arcade.moveToXY(this.player,a,this.player.y,150):(this.phase=3,this.player.body.velocity.x=0,this.player.allowJump=!0,this.bg.scroll(-50),this.bg.scrollClouds(-40,-20),this.ground.scroll(-150),this.spawn=!0,this.enemies.maxSpeed=275,this.enemies.direction="random")}},BasicGame.Menu=function(){this.bg=null,this.ground=null,this.typeCounter=0,this.tweenInProgress=!1},BasicGame.Menu.prototype={init:function(a){a||(a={bgType:"grass",playerType:"blue",bestScore:0}),this.config=a},create:function(){this.bg=new Background(game,this.config.bgType),this.ground=new Ground(game,this.config.bgType),this.menu=this.add.group();var a=this.add.button(.5*game.width-48,.5*game.height,"sprites",this.startClick,this,"play_btn.png","play_btn.png","play_btn_hover.png");a.anchor.set(.5),a.input.useHandCursor=!0,this.menu.add(a);var b=this.add.button(.5*game.width+48,.5*game.height,"sprites",this.showOptions,this,"options_btn.png","options_btn.png","options_btn_hover.png");b.anchor.set(.5),b.input.useHandCursor=!0,this.menu.add(b),this.bgSelect=this.add.group();var c=this.add.button(.5*game.width-140,100,"sprites",this.selectBg,this,"grass_btn.png","grass_btn.png","grass_btn_hover.png");c.type="grass",c.input.useHandCursor=!0,this.bgSelect.add(c);var d=this.add.button(.5*game.width-44,100,"sprites",this.selectBg,this,"desert_btn.png","desert_btn.png","desert_btn_hover.png");d.type="desert",d.input.useHandCursor=!0,this.bgSelect.add(d);var e=this.add.button(.5*game.width+52,100,"sprites",this.selectBg,this,"dirt_btn.png","dirt_btn.png","dirt_btn_hover.png");e.type="dirt",e.input.useHandCursor=!0,this.bgSelect.add(e),this.bgSelect.x=game.width,this.bgSelect.alpha=0,this.player=new Player(game,.5*game.width,game.height-78,"sprites",this.config.playerType),this.player.body.allowGravity=!1,this.player.x=-24,this.player.play("runRight"),this.playerSelect=this.add.group();var f=this.add.button(.5*game.width+36,320,"sprites",this.selectPlayer,this,"next_btn.png","next_btn.png","next_btn_hover.png");f.direction="next",f.input.useHandCursor=!0,this.playerSelect.add(f);var g=this.add.button(.5*game.width-64,320,"sprites",this.selectPlayer,this,"prev_btn.png","prev_btn.png","prev_btn_hover.png");g.direction="prev",g.input.useHandCursor=!0,this.playerSelect.add(g),this.playerSelect.y=-20,this.playerSelect.alpha=0,this.menuReturn=this.add.button(-48,16,"sprites",this.showMenu,this,"menu_btn.png","menu_btn.png","menu_btn_hover.png"),this.menuReturn.alpha=0,this.menuReturn.input.useHandCursor=!0,this.startBtn=this.add.button(game.width,16,"sprites",this.startClick,this,"play_btn.png","play_btn.png","play_btn_hover.png"),this.startBtn.alpha=0,this.startBtn.input.useHandCursor=!0},update:function(){this.physics.arcade.collide(this.player,this.ground)},startClick:function(){this.state.start("Game",!0,!1,this.config)},showOptions:function(){var a=this.add.tween(this.menu).to({y:-100,alpha:0},250,Phaser.Easing.Cubic.Out,!0),b=this.add.tween(this.player).to({x:.5*game.width},900,Phaser.Easing.Default,!1);b.onComplete.add(function(){this.player.play("stand"),this.tweenInProgress=!1,this.add.tween(this.bgSelect).to({x:0,alpha:1},250,Phaser.Easing.Cubic.Out,!0),this.add.tween(this.playerSelect).to({y:0,alpha:1},250,Phaser.Easing.Cubic.Out,!0),this.add.tween(this.menuReturn).to({x:16,alpha:1},250,Phaser.Easing.Cubic.Out,!0),this.add.tween(this.startBtn).to({x:game.width-42,alpha:1},250,Phaser.Easing.Cubic.Out,!0)},this),a.onComplete.add(function(){b.start()})},showMenu:function(){var a=this.add.tween(this.player).to({x:game.width+24},900,Phaser.Easing.Default,!1);a.onComplete.add(function(){this.player.x=-24,this.add.tween(this.menu).to({y:0,alpha:1},250,Phaser.Easing.Cubic.Out,!0)},this);var b=this.add.tween(this.bgSelect).to({x:game.width,alpha:0},250,Phaser.Easing.Cubic.Out,!0);this.add.tween(this.playerSelect).to({y:-20,alpha:0},250,Phaser.Easing.Cubic.Out,!0),this.add.tween(this.menuReturn).to({x:-48,alpha:0},250,Phaser.Easing.Cubic.Out,!0),this.add.tween(this.startBtn).to({x:game.width,alpha:0},250,Phaser.Easing.Cubic.Out,!0),b.onComplete.add(function(){this.player.play("runRight"),a.start()},this)},selectBg:function(a){this.bg.change(a.type),this.ground.change(a.type),this.config.bgType=a.type},selectPlayer:function(a){if(!this.tweenInProgress){this.tweenInProgress=!0,this.player.animations.stop(),this.player.play("runRight"),"next"===a.direction?(this.typeCounter++,this.typeCounter>=this.player.typesArr.length&&(this.typeCounter=0)):(this.typeCounter--,this.typeCounter<0&&(this.typeCounter=this.player.typesArr.length-1));var b=this.add.tween(this.playerSelect).to({y:0,alpha:1},100),c=this.add.tween(this.playerSelect).to({y:-20,alpha:0},100),d=this.add.tween(this.player).to({x:game.width+24},900,Phaser.Easing.Default,!1);d.onComplete.add(function(){this.player.addAnimations(this.player.typesArr[this.typeCounter]),this.player.play("runRight"),this.player.x=-24},this);var e=this.add.tween(this.player).to({x:.5*game.width},900,Phaser.Easing.Default,!1);e.onComplete.add(function(){this.player.play("stand"),this.tweenInProgress=!1,b.start()},this),d.chain(e),c.onComplete.add(function(){d.start()}),c.start(),this.config.playerType=this.player.typesArr[this.typeCounter]}}},BasicGame.Preload=function(){this.preloadBar=null,this.ready=!1},BasicGame.Preload.prototype={preload:function(){this.preloadBar=this.add.sprite(.5*game.width,.5*game.height,"preloader",0),this.preloadBar.anchor.set(.5,.5);var a=[],b=0;for(b;33>b;b++)a[b]=b;this.preloadBar.animations.add("loading",a,60,!0),this.preloadBar.play("loading"),this.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.load.atlas("sprites","res/sprites.png","res/sprites.json"),this.load.image("ground_grass","res/ground_grass.png"),this.load.image("ground_desert","res/ground_desert.png"),this.load.image("ground_dirt","res/ground_dirt.png"),this.load.image("bg_grass","res/bg_grass.png"),this.load.image("bg_desert","res/bg_desert.png"),this.load.image("bg_dirt","res/bg_dirt.png"),this.load.image("bg_clouds_1","res/bg_clouds_1.png"),this.load.image("bg_clouds_2","res/bg_clouds_2.png"),this.load.image("board","res/board.png"),this.load.image("score","res/score.png"),this.load.image("best","res/best.png"),this.load.audio("music","res/audio/music.ogg"),this.load.audio("jump","res/audio/jump.wav"),this.load.audio("doublejump","res/audio/doublejump.wav"),this.load.audio("hit","res/audio/hit.wav"),this.load.bitmapFont("font","res/font.png","res/font.fnt")},create:function(){this.preloadBar.cropEnabled=!1},update:function(){this.ready&&this.state.start("Menu")},onLoadComplete:function(){this.ready=!0}};var game=new Phaser.Game(300,420,Phaser.AUTO,"game_cont");game.state.add("Boot",BasicGame.Boot),game.state.add("Preload",BasicGame.Preload),game.state.add("Menu",BasicGame.Menu),game.state.add("Game",BasicGame.Game),game.state.start("Boot");