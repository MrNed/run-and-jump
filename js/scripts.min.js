var Background=function(a){a.stage.backgroundColor="#d0f4f7",this.cloudsSecond=a.add.tileSprite(0,a.height-320,967,177,"bg_clouds_2"),this.cloudsSecond.autoScroll(-20,0),this.cloudsFirst=a.add.tileSprite(-200,a.height-250,967,177,"bg_clouds_1"),this.cloudsFirst.autoScroll(-40,0),this.front=a.add.tileSprite(0,a.height-264,967,264,"bg_front")};Background.prototype=Object.create(Phaser.Group.prototype),Background.prototype.constructor=Background,Background.prototype.startFrontScroll=function(){this.front.autoScroll(-50,0)},Background.prototype.stopFrontScroll=function(){this.front.autoScroll(0,0)};var Enemies=function(a){this.enemiesCounter=0,this.possibleEnemies=["mouse","bee"],Phaser.Group.call(this,a,a.world,"Enemies",!1,!0,Phaser.Physics.ARCADE),this.nextSpawn=0,this.minSpawnRate=1e3,this.maxSpawnRate=2e3,this.minSpeed=200,this.maxSpeed=400;var b=0,c=this.possibleEnemies.length;for(b;c>b;b++)for(j=0;j<3;j++)this.add(new Enemy(a,"sprites",this.possibleEnemies[b]),!0);return this};Enemies.prototype=Object.create(Phaser.Group.prototype),Enemies.prototype.constructor=Enemies,Enemies.prototype.spawn=function(){if(!(this.game.time.time<this.nextSpawn)){this.children.sort(function(){return.5-Math.random()});var a=-(game.rnd.integerInRange(this.minSpeed,this.maxSpeed)+5*this.enemiesCounter),b=game.rnd.integerInRange(this.minSpawnRate,this.maxSpawnRate)-10*this.enemiesCounter;this.getFirstExists(!1).spawn(this.game.width,this.game.height-72,a),this.nextSpawn=this.game.time.time+b,this.enemiesCounter++}};var Enemy=function(a,b,c){this.enemyType=c,Phaser.Sprite.call(this,a,0,0,b,c+".png"),a.physics.arcade.enable(this),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.exists=!1,this.body.allowGravity=!1,this.animations.add("move",[c+".png",c+"_move.png"],5,!0),this.animations.play("move")};Enemy.prototype=Object.create(Phaser.Sprite.prototype),Enemy.prototype.constructor=Enemy,Enemy.prototype.stop=function(){this.body.velocity.x=0,this.body.moves=!1,this.animations.stop()},Enemy.prototype.spawn=function(a,b,c){"bee"===this.enemyType&&(b-=24),this.reset(a,b),this.hasScored=!1,this.body.velocity.x=c};var Ground=function(a,b,c,d,e){Phaser.TileSprite.call(this,a,b,c,d,e,"ground"),this.physicsType=Phaser.SPRITE,a.physics.arcade.enableBody(this),this.body.allowGravity=!1,this.body.immovable=!0,a.world.add(this)};Ground.prototype=Object.create(Phaser.TileSprite.prototype),Ground.prototype.constructor=Ground,Ground.prototype.startScroll=function(){this.autoScroll(-150,0)},Ground.prototype.stopScroll=function(){this.autoScroll(0,0)};var Board=function(a){this.score=0,this.scoreTxt="",this.scoreField="Score:",this.best=0,this.bestTxt="",this.bestField="Best:",this.board=a.add.group();var b=a.add.image(.5*a.width-110,100,"board");this.board.add(b);var c=a.add.button(a.width-75,130,"menu_btn",this.menuClick,this);c.anchor.set(.5),c.input.useHandCursor=!0,this.board.add(c);var d=a.add.button(a.width-75,190,"repeat_btn",this.repeatClick,this);d.anchor.set(.5),d.input.useHandCursor=!0,this.board.add(d);this.scoreText=a.add.bitmapText(a.width/2,150,"font","0",22),this.scoreField=a.add.image(.5*a.width-100,150,"score"),this.bestText=a.add.bitmapText(a.width/2,180,"font","0",22),this.bestField=a.add.image(.5*a.width-100,180,"best"),this.board.add(this.scoreText),this.board.add(this.scoreField),this.board.add(this.bestText),this.board.add(this.bestField),this.board.alpha=0,this.board.y=a.height};Board.prototype.menuClick=function(){game.state.start("menu")},Board.prototype.repeatClick=function(){game.state.start("play")},Board.prototype.show=function(a,b){this.scoreText.text=a.toString(),this.bestText.text=b.toString(),game.add.tween(this.board).to({alpha:1,y:0},500,Phaser.Easing.Exponential.Out,!0,0)};var Player=function(a,b,c,d,e,f){this.playerType=e,this.alive=!0,this.doubleJump=!0,this.jumpHeight=500,"undefined"==typeof f&&(f="walk_2"),Phaser.Sprite.call(this,a,b,c,d,e+"_"+f+".png"),a.physics.arcade.enable(this),this.body.bounce.y=0,this.body.gravity.y=500,this.body.collideWorldBounds=!0,this.animations.add("runRight",[e+"_walk_1.png",e+"_walk_2.png"],10,!0),a.world.add(this)};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player,Player.prototype.onGround=function(){return this.body.blocked.down||this.body.touching.down},Player.prototype.jump=function(){this.alive&&(this.onGround()||!this.onGround()&&this.doubleJump)&&(this.animations.stop(),this.frameName=this.playerType+"_jump.png",this.onGround()?this.body.velocity.y=-this.jumpHeight:(this.doubleJump=!1,this.body.velocity.y=-(.75*this.jumpHeight)))},Player.prototype.run=function(){this.onGround()&&this.alive&&(this.doubleJump=!0,this.play("runRight"))},Player.prototype.hitEnemy=function(){this.alive=!1,this.animations.stop(),this.frameName=this.playerType+"_hit.png",this.body.gravity.y=0,this.body.moves=!1};var Boot=function(){};Boot.prototype={preload:function(){this.game.load.image("preloader","res/preloader.gif")},create:function(){this.game.stage.backgroundColor="#d0f4f7",this.game.input.maxPointers=1,this.game.state.start("preload")}};var Menu=function(){};Menu.prototype={create:function(){this.bg=new Background(this.game),this.ground=new Ground(this.game,0,this.game.height-48,480,48);var a=this.add.button(.5*game.width,.5*game.height,"play_btn",this.startClick,this);a.anchor.set(.5),a.input.useHandCursor=!0},startClick:function(){this.game.state.start("play")}};var Play=function(){this.player=null,this.ground=null,this.enemies=null,this.board=null,this.spawn=!1,this.score=0,this.scoreText="",this.bestScore=0,this.timer=null,this.spawnDelay=1e3};Play.prototype={init:function(){this.game.renderer.renderSession.roundPixels=!0,this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.gravity.y=800,this.game.time.advancedTiming=!0},create:function(){this.bg=new Background(this.game),this.bg.startFrontScroll(),this.ground=new Ground(this.game,0,this.game.height-48,480,48),this.ground.startScroll(),this.player=new Player(this.game,48,this.game.height-108,"sprites","blue"),this.enemies=new Enemies(this.game),this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);var a=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);a.onDown.add(this.player.jump,this.player),this.input.onDown.add(this.player.jump,this.player),this.scoreText=this.game.add.bitmapText(.5*this.game.width,5,"font","0",22),this.timer=new Phaser.Timer(this.game),this.timer.add(this.spawnDelay,function(){this.spawn=!0},this),this.timer.start(),this.board=new Board(this.game)},update:function(){this.timer.update(this.game.time.time),this.game.physics.arcade.collide(this.player,this.ground),this.game.physics.arcade.collide(this.player,this.enemies,this.die,null,this),this.player.run(),this.spawn&&this.enemies.spawn();var a=this;this.enemies.forEach(function(b){a.checkScore(b)})},shutdown:function(){this.score=0,this.spawn=!1,this.timer=null},die:function(a,b){this.spawn=!1,this.physics.arcade.gravity.y=0,this.ground.stopScroll(),this.bg.stopFrontScroll(),a.hitEnemy();this.enemies.forEach(function(a){a.stop()}),this.score>this.bestScore&&(this.bestScore=this.score),this.board.show(this.score,this.bestScore)},checkScore:function(a){a.exists&&!a.hasScored&&a.world.x<=this.player.world.x&&(a.hasScored=!0,this.score++,this.scoreText.text=this.score.toString())},render:function(){this.game.debug.text(this.game.time.fps||"--",2,16,"#00ff00")}};var Preload=function(){this.asset=null,this.ready=!1};Preload.prototype={preload:function(){this.asset=this.add.sprite(.5*game.width,.5*game.height,"preloader"),this.asset.anchor.set(.5,.5),this.game.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.game.load.atlas("sprites","res/sprites.png","res/sprites.json"),this.game.load.image("ground","res/ground_grass.png"),this.game.load.image("bg_front","res/bg_front_grass.png"),this.game.load.image("bg_clouds_1","res/bg_clouds1_grass.png"),this.game.load.image("bg_clouds_2","res/bg_clouds2_grass.png"),this.game.load.image("board","res/board.png"),this.game.load.image("play_btn","res/play.png"),this.game.load.image("repeat_btn","res/repeat.png"),this.game.load.image("menu_btn","res/menu.png"),this.game.load.image("score","res/score.png"),this.game.load.image("best","res/best.png"),this.load.bitmapFont("font","res/font.png","res/font.fnt")},create:function(){this.asset.cropEnabled=!1},update:function(){this.ready&&this.game.state.start("menu")},onLoadComplete:function(){this.ready=!0}};var game=new Phaser.Game(300,420,Phaser.Canvas,"game_cont");game.state.add("boot",new Boot),game.state.add("preload",new Preload),game.state.add("menu",new Menu),game.state.add("play",new Play),game.state.start("boot");