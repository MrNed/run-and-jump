var Background=function(a,b){"undefined"==typeof b&&(b="grass"),a.stage.backgroundColor="#d0f4f7",this.cloudsSecond=a.add.tileSprite(0,a.height-320,967,177,"bg_clouds_2"),this.cloudsSecond.autoScroll(-20,0),this.cloudsFirst=a.add.tileSprite(-200,a.height-250,967,177,"bg_clouds_1"),this.cloudsFirst.autoScroll(-40,0),this.front=a.add.tileSprite(0,a.height-264,967,264,"bg_"+b)};Background.prototype=Object.create(Phaser.Group.prototype),Background.prototype.constructor=Background,Background.prototype.startFrontScroll=function(){this.front.autoScroll(-50,0)},Background.prototype.stopFrontScroll=function(){this.front.autoScroll(0,0)},Background.prototype.change=function(a){this.front.loadTexture("bg_"+a)};var Enemies=function(a){this.enemiesCounter=0,this.possibleEnemies=["mouse","bee"],Phaser.Group.call(this,a,a.world,"Enemies",!1,!0,Phaser.Physics.ARCADE),this.nextSpawn=0,this.minSpawnRate=1e3,this.maxSpawnRate=2e3,this.minSpeed=200,this.maxSpeed=400;var b=0,c=this.possibleEnemies.length;for(b;c>b;b++)for(j=0;j<3;j++)this.add(new Enemy(a,"sprites",this.possibleEnemies[b]),!0);return this};Enemies.prototype=Object.create(Phaser.Group.prototype),Enemies.prototype.constructor=Enemies,Enemies.prototype.spawn=function(){if(!(this.game.time.time<this.nextSpawn)){this.children.sort(function(){return.5-Math.random()});var a=-(game.rnd.integerInRange(this.minSpeed,this.maxSpeed)+5*this.enemiesCounter),b=game.rnd.integerInRange(this.minSpawnRate,this.maxSpawnRate)-10*this.enemiesCounter;this.getFirstExists(!1).spawn(this.game.width,this.game.height-72,a),this.nextSpawn=this.game.time.time+b,this.enemiesCounter++}};var Enemy=function(a,b,c){this.enemyType=c,Phaser.Sprite.call(this,a,0,0,b,c+".png"),a.physics.arcade.enable(this),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.exists=!1,this.body.allowGravity=!1,this.animations.add("move",[c+".png",c+"_move.png"],5,!0),this.animations.play("move")};Enemy.prototype=Object.create(Phaser.Sprite.prototype),Enemy.prototype.constructor=Enemy,Enemy.prototype.stop=function(){this.body.velocity.x=0,this.body.moves=!1,this.animations.stop()},Enemy.prototype.spawn=function(a,b,c){"bee"===this.enemyType&&(b-=24),this.reset(a,b),this.hasScored=!1,this.body.velocity.x=c};var Ground=function(a,b){"undefined"==typeof b&&(b="grass"),Phaser.TileSprite.call(this,a,0,a.height-48,480,48,"ground_"+b),this.physicsType=Phaser.SPRITE,a.physics.arcade.enableBody(this),this.body.allowGravity=!1,this.body.immovable=!0,a.world.add(this)};Ground.prototype=Object.create(Phaser.TileSprite.prototype),Ground.prototype.constructor=Ground,Ground.prototype.startScroll=function(){this.autoScroll(-150,0)},Ground.prototype.stopScroll=function(){this.autoScroll(0,0)},Ground.prototype.change=function(a){this.loadTexture("ground_"+a)};var Board=function(a,b){this.config=b,this.score=0,this.scoreTxt="",this.scoreField="Score:",this.best=0,this.bestTxt="",this.bestField="Best:",this.board=a.add.group();var c=a.add.image(.5*a.width-110,100,"board");this.board.add(c);var d=a.add.button(a.width-75,130,"sprites",this.menuClick,this,"menu_btn_hover.png","menu_btn.png");d.anchor.set(.5),d.input.useHandCursor=!0,this.board.add(d);var e=a.add.button(a.width-75,190,"sprites",this.repeatClick,this,"repeat_btn_hover.png","repeat_btn.png");e.anchor.set(.5),e.input.useHandCursor=!0,this.board.add(e);this.scoreText=a.add.bitmapText(a.width/2,120,"font","0",22),this.scoreField=a.add.image(.5*a.width-100,120,"score"),this.bestText=a.add.bitmapText(a.width/2,180,"font","0",22),this.bestField=a.add.image(.5*a.width-100,180,"best"),this.board.add(this.scoreText),this.board.add(this.scoreField),this.board.add(this.bestText),this.board.add(this.bestField),this.board.alpha=0,this.board.y=a.height};Board.prototype.menuClick=function(){game.state.start("Menu",!0,!1,this.config)},Board.prototype.repeatClick=function(){game.state.start("Game",!0,!1,this.config)},Board.prototype.show=function(a,b){this.scoreText.text=a.toString(),this.bestText.text=b.toString(),game.add.tween(this.board).to({alpha:1,y:0},500,Phaser.Easing.Exponential.Out,!0,0)};var Player=function(a,b,c,d,e,f){this.playerType=e,this.typesArr=["blue","beige","green","pink","yellow"],this.alive=!0,this.allowJump=!1,this.doubleJump=!0,this.jumpHeight=500,this.tweenInProgress=!1,"undefined"==typeof f&&(f="walk_2"),Phaser.Sprite.call(this,a,b,c,d,e+"_"+f+".png"),a.physics.arcade.enable(this),this.anchor.set(.5,.5),this.body.bounce.y=0,this.body.gravity.y=500,this.addAnimations(e),a.world.add(this)};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player,Player.prototype.onGround=function(){return this.body.blocked.down||this.body.touching.down},Player.prototype.jump=function(){this.alive&&this.allowJump&&(this.onGround()||!this.onGround()&&this.doubleJump)&&(this.animations.stop(),this.frameName=this.playerType+"_jump.png",this.onGround()?this.body.velocity.y=-this.jumpHeight:(this.doubleJump=!1,this.body.velocity.y=-(.75*this.jumpHeight)))},Player.prototype.run=function(){this.onGround()&&this.alive&&(this.doubleJump=!0,this.play("runRight"))},Player.prototype.hitEnemy=function(){this.alive=!1,this.animations.stop(),this.frameName=this.playerType+"_hit.png",this.body.gravity.y=0,this.body.moves=!1},Player.prototype.addAnimations=function(a){this.animations.add("runRight",[a+"_walk_1.png",a+"_walk_2.png"],10,!0),this.animations.add("stand",[a+"_front.png",a+"_stand_right.png",a+"_front.png",a+"_stand_left.png"],.75,!0)};var BasicGame={};BasicGame.Boot=function(){},BasicGame.Boot.prototype={init:function(){this.input.maxPointers=1,this.stage.disableVisibilityChange=!0},preload:function(){this.load.atlas("preloader","res/preloader.png","res/preloader.json")},create:function(){this.stage.backgroundColor="#F5F5F5",this.state.start("Preload")}},BasicGame.Game=function(a){this.player=null,this.ground=null,this.enemies=null,this.board=null,this.spawn=!1,this.score=0,this.scoreText="",this.bestScore=0,this.timer=null,this.spawnDelay=1e3},BasicGame.Game.prototype={init:function(a){this.config=a,game.renderer.renderSession.roundPixels=!0,this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.gravity.y=800},create:function(){this.bg=new Background(game,this.config.bgType),this.bg.startFrontScroll(),this.ground=new Ground(game,this.config.bgType),this.ground.startScroll(),this.player=new Player(game,-20,game.height-74,"sprites",this.config.playerType);var a=this.add.tween(this.player).to({x:48},500,Phaser.Easing.Default,!0);a.onComplete.add(function(){this.player.allowJump=!0,this.timer.start()},this),this.enemies=new Enemies(game),this.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);var b=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);b.onDown.add(this.player.jump,this.player),this.input.onDown.add(this.player.jump,this.player),this.scoreText=this.add.bitmapText(.5*game.width,5,"font","0",22),this.timer=new Phaser.Timer(game),this.timer.add(this.spawnDelay,function(){this.spawn=!0},this),this.board=new Board(game,this.config)},update:function(){this.timer.update(game.time.time),this.physics.arcade.collide(this.player,this.ground),this.physics.arcade.collide(this.player,this.enemies,this.die,null,this),this.player.run(),this.spawn&&this.enemies.spawn();var a=this;this.enemies.forEach(function(b){a.checkScore(b)})},shutdown:function(){this.score=0,this.spawn=!1,this.timer=null},die:function(a,b){this.spawn=!1,this.physics.arcade.gravity.y=0,this.ground.stopScroll(),this.bg.stopFrontScroll(),a.hitEnemy();this.enemies.forEach(function(a){a.stop()}),this.score>this.bestScore&&(this.bestScore=this.score),this.board.show(this.score,this.bestScore)},checkScore:function(a){a.exists&&!a.hasScored&&a.world.x<=this.player.world.x&&(a.hasScored=!0,this.score++,this.scoreText.text=this.score.toString())}},BasicGame.Menu=function(){this.bg=null,this.ground=null,this.typeCounter=0,this.tweenInProgress=!1},BasicGame.Menu.prototype={init:function(a){a||(a={bgType:"grass",playerType:"blue",bestScore:0}),this.config=a},create:function(){this.bg=new Background(game,this.config.bgType),this.ground=new Ground(game,this.config.bgType),this.menu=this.add.group();var a=this.add.button(.5*game.width-48,.5*game.height,"sprites",this.startClick,this,"play_btn_hover.png","play_btn.png","play_btn.png");a.anchor.set(.5),a.input.useHandCursor=!0,this.menu.add(a);var b=this.add.button(.5*game.width+48,.5*game.height,"sprites",this.showOptions,this,"options_btn_hover.png","options_btn.png","options_btn.png");b.anchor.set(.5),b.input.useHandCursor=!0,this.menu.add(b),this.bgSelect=this.add.group();var c=this.add.button(.5*game.width-140,100,"sprites",this.selectBg,this,"grass_btn_hover.png","grass_btn.png","grass_btn.png");c.type="grass",c.input.useHandCursor=!0,this.bgSelect.add(c);var d=this.add.button(.5*game.width-44,100,"sprites",this.selectBg,this,"desert_btn_hover.png","desert_btn.png","desert_btn.png");d.type="desert",d.input.useHandCursor=!0,this.bgSelect.add(d);var e=this.add.button(.5*game.width+52,100,"sprites",this.selectBg,this,"dirt_btn_hover.png","dirt_btn.png","dirt_btn.png");e.type="dirt",e.input.useHandCursor=!0,this.bgSelect.add(e),this.bgSelect.x=game.width,this.bgSelect.alpha=0,this.player=new Player(game,.5*game.width,game.height-74,"sprites",this.config.playerType),this.player.body.allowGravity=!1,this.player.x=-24,this.player.play("runRight"),this.playerSelect=this.add.group();var f=this.add.button(.5*game.width+36,320,"sprites",this.selectPlayer,this,"next_btn_hover.png","next_btn.png","next_btn.png");f.direction="next",f.input.useHandCursor=!0,this.playerSelect.add(f);var g=this.add.button(.5*game.width-64,320,"sprites",this.selectPlayer,this,"prev_btn_hover.png","prev_btn.png","prev_btn.png");g.direction="prev",g.input.useHandCursor=!0,this.playerSelect.add(g),this.playerSelect.y=-20,this.playerSelect.alpha=0,this.menuReturn=this.add.button(-48,16,"sprites",this.showMenu,this,"menu_btn_hover.png","menu_btn.png"),this.menuReturn.alpha=0,this.menuReturn.input.useHandCursor=!0,this.startBtn=this.add.button(game.width,16,"sprites",this.startClick,this,"play_btn_hover.png","play_btn.png","play_btn.png"),this.startBtn.alpha=0,this.startBtn.input.useHandCursor=!0},update:function(){this.physics.arcade.collide(this.player,this.ground)},startClick:function(){this.state.start("Game",!0,!1,this.config)},showOptions:function(){var a=this,b=this.add.tween(this.menu).to({y:-100,alpha:0},250,Phaser.Easing.Cubic.Out,!0),c=this.add.tween(this.player).to({x:.5*game.width},900,Phaser.Easing.Default,!1);c.onComplete.add(function(){a.player.play("stand"),a.tweenInProgress=!1,a.add.tween(a.bgSelect).to({x:0,alpha:1},250,Phaser.Easing.Cubic.Out,!0),a.add.tween(a.playerSelect).to({y:0,alpha:1},250,Phaser.Easing.Cubic.Out,!0),a.add.tween(a.menuReturn).to({x:16,alpha:1},250,Phaser.Easing.Cubic.Out,!0),a.add.tween(a.startBtn).to({x:game.width-42,alpha:1},250,Phaser.Easing.Cubic.Out,!0)}),b.onComplete.add(function(){c.start()})},showMenu:function(){var a=this,b=this.add.tween(this.player).to({x:game.width+24},900,Phaser.Easing.Default,!1);b.onComplete.add(function(){a.player.x=-24,a.add.tween(a.menu).to({y:0,alpha:1},250,Phaser.Easing.Cubic.Out,!0)});var c=this.add.tween(a.bgSelect).to({x:game.width,alpha:0},250,Phaser.Easing.Cubic.Out,!0);this.add.tween(a.playerSelect).to({y:-20,alpha:0},250,Phaser.Easing.Cubic.Out,!0),this.add.tween(a.menuReturn).to({x:-48,alpha:0},250,Phaser.Easing.Cubic.Out,!0),this.add.tween(a.startBtn).to({x:game.width,alpha:0},250,Phaser.Easing.Cubic.Out,!0),c.onComplete.add(function(){a.player.play("runRight"),b.start()})},selectBg:function(a){this.bg.change(a.type),this.ground.change(a.type),this.config.bgType=a.type},selectPlayer:function(a){if(!this.tweenInProgress){this.tweenInProgress=!0,this.player.animations.stop(),this.player.play("runRight"),"next"===a.direction?(this.typeCounter++,this.typeCounter>=this.player.typesArr.length&&(this.typeCounter=0)):(this.typeCounter--,this.typeCounter<0&&(this.typeCounter=this.player.typesArr.length-1));var b=this,c=this.player,d=this.add.tween(this.playerSelect).to({y:0,alpha:1},100),e=this.add.tween(this.playerSelect).to({y:-20,alpha:0},100),f=this.add.tween(c).to({x:game.width+24},900,Phaser.Easing.Default,!1);f.onComplete.add(function(){c.addAnimations(c.typesArr[b.typeCounter]),c.play("runRight"),c.x=-24});var g=this.add.tween(c).to({x:.5*game.width},900,Phaser.Easing.Default,!1);g.onComplete.add(function(){c.play("stand"),b.tweenInProgress=!1,d.start()}),f.chain(g),e.onComplete.add(function(){f.start()}),e.start(),this.config.playerType=this.player.typesArr[this.typeCounter]}}},BasicGame.Preload=function(){this.preloadBar=null,this.ready=!1},BasicGame.Preload.prototype={preload:function(){this.preloadBar=this.add.sprite(.5*game.width,.5*game.height,"preloader",0),this.preloadBar.anchor.set(.5,.5);var a=[],b=0;for(b;33>b;b++)a[b]=b;this.preloadBar.animations.add("loading",a,60,!0),this.preloadBar.play("loading"),this.load.onLoadComplete.addOnce(this.onLoadComplete,this),this.load.atlas("sprites","res/sprites.png","res/sprites.json"),this.load.image("ground_grass","res/ground_grass.png"),this.load.image("ground_desert","res/ground_desert.png"),this.load.image("ground_dirt","res/ground_dirt.png"),this.load.image("bg_grass","res/bg_grass.png"),this.load.image("bg_desert","res/bg_desert.png"),this.load.image("bg_dirt","res/bg_dirt.png"),this.load.image("bg_clouds_1","res/bg_clouds_1.png"),this.load.image("bg_clouds_2","res/bg_clouds_2.png"),this.load.image("board","res/board.png"),this.load.image("score","res/score.png"),this.load.image("best","res/best.png"),this.load.bitmapFont("font","res/font.png","res/font.fnt")},create:function(){this.preloadBar.cropEnabled=!1},update:function(){this.ready&&this.state.start("Menu")},onLoadComplete:function(){this.ready=!0}};var game=new Phaser.Game(300,420,Phaser.AUTO,"game_cont");game.state.add("Boot",BasicGame.Boot),game.state.add("Preload",BasicGame.Preload),game.state.add("Menu",BasicGame.Menu),game.state.add("Game",BasicGame.Game),game.state.start("Boot");