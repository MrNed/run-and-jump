var Enemies=function(a){this.enemiesCounter=0,this.possibleEnemies=["mouse","bee"],Phaser.Group.call(this,a,a.world,"Enemies",!1,!0,Phaser.Physics.ARCADE),this.nextSpawn=0,this.minSpawnRate=1e3,this.maxSpawnRate=2e3,this.minSpeed=200,this.maxSpeed=400;var b=0,c=this.possibleEnemies.length;for(b;c>b;b++)for(j=0;j<5;j++)this.add(new Enemy(a,"sprites",this.possibleEnemies[b]),!0);return this};Enemies.prototype=Object.create(Phaser.Group.prototype),Enemies.prototype.constructor=Enemies,Enemies.prototype.spawn=function(){if(!(this.game.time.time<this.nextSpawn)){this.children.sort(function(){return.5-Math.random()});var a=-(game.rnd.integerInRange(this.minSpeed,this.maxSpeed)+5*this.enemiesCounter),b=game.rnd.integerInRange(this.minSpawnRate,this.maxSpawnRate)-10*this.enemiesCounter;this.getFirstExists(!1).spawn(this.game.width,this.game.height-72,a),this.nextSpawn=this.game.time.time+b,this.enemiesCounter++}};var Enemy=function(a,b,c){this.enemyType=c,Phaser.Sprite.call(this,a,0,0,b,c+".png"),a.physics.arcade.enable(this),this.checkWorldBounds=!0,this.outOfBoundsKill=!0,this.exists=!1,this.body.allowGravity=!1,this.animations.add("move",[c+".png",c+"_move.png"],5,!0),this.animations.play("move")};Enemy.prototype=Object.create(Phaser.Sprite.prototype),Enemy.prototype.constructor=Enemy,Enemy.prototype.stop=function(){this.body.velocity.x=0,this.body.moves=!1,this.animations.stop()},Enemy.prototype.spawn=function(a,b,c){"bee"===this.enemyType&&(b-=24),this.reset(a,b),this.hasScored=!1,this.body.velocity.x=c};var Ground=function(a,b,c,d,e){Phaser.TileSprite.call(this,a,b,c,d,e,"ground"),this.autoScroll(-150,0),this.physicsType=Phaser.SPRITE,a.physics.arcade.enableBody(this),this.body.allowGravity=!1,this.body.immovable=!0,a.world.add(this)};Ground.prototype=Object.create(Phaser.TileSprite.prototype),Ground.prototype.constructor=Ground;var Player=function(a,b,c,d,e,f){this.playerType=e,this.died=!1,this.doubleJump=!0,this.jumpHeight=500,"undefined"==typeof f&&(f="walk_2"),Phaser.Sprite.call(this,a,b,c,d,e+"_"+f+".png"),a.physics.arcade.enable(this),this.body.bounce.y=.1,this.body.gravity.y=500,this.body.collideWorldBounds=!0,this.animations.add("runRight",[e+"_walk_1.png",e+"_walk_2.png"],10,!0),a.world.add(this)};Player.prototype=Object.create(Phaser.Sprite.prototype),Player.prototype.constructor=Player,Player.prototype.onGround=function(){return this.body.blocked.down||this.body.touching.down},Player.prototype.jump=function(){(this.onGround()||!this.onGround()&&this.doubleJump)&&(this.animations.stop(),this.frameName=this.playerType+"_jump.png",this.onGround()?this.body.velocity.y=-this.jumpHeight:(this.doubleJump=!1,this.body.velocity.y=-(.75*this.jumpHeight)))},Player.prototype.run=function(){this.onGround()&&!this.died&&(this.doubleJump=!0,this.play("runRight"))},Player.prototype.hitEnemy=function(){this.died=!0,this.animations.stop(),this.frameName=this.playerType+"_hit.png",this.body.gravity.y=0,this.body.moves=!1};var Play=function(){this.player=null,this.ground=null,this.enemies=null,this.paused=!1,this.score=0,this.scoreText=""};Play.prototype={init:function(){this.game.renderer.renderSession.roundPixels=!0,this.physics.startSystem(Phaser.Physics.ARCADE),this.physics.arcade.gravity.y=800},preload:function(){this.game.load.atlas("sprites","res/sprites.png","res/sprites.json"),this.game.load.image("ground","res/ground_grass.png"),this.game.load.image("background","res/bg_grass.png")},create:function(){this.bg=this.game.add.tileSprite(0,0,480,967,"background"),this.bg.autoScroll(-50,0),this.ground=new Ground(this.game,0,this.game.height-48,480,48),this.player=new Player(this.game,48,this.game.height-108,"sprites","blue"),this.enemies=new Enemies(this.game),this.game.input.keyboard.addKeyCapture([Phaser.Keyboard.SPACEBAR]);var a=this.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR);a.onDown.add(this.player.jump,this.player),this.input.onDown.add(this.player.jump,this.player);var b={font:"24px Share Tech Mono",fill:"#FBFBFB",stroke:"#424242",strokeThickness:3};this.scoreText=this.game.add.text(5,5,"0",b)},update:function(){this.game.physics.arcade.collide(this.player,this.ground),this.game.physics.arcade.collide(this.player,this.enemies,this.die,null,this),this.player.run(),this.paused||this.enemies.spawn();var a=this;this.enemies.forEach(function(b){a.checkScore(b)})},die:function(a,b){this.paused=!0,this.physics.arcade.gravity.y=0,this.ground.autoScroll(0,0),this.bg.autoScroll(0,0),a.hitEnemy();this.enemies.forEach(function(a){a.stop()})},checkScore:function(a){a.exists&&!a.hasScored&&a.world.x<=this.player.world.x&&(a.hasScored=!0,this.score++,this.scoreText.text=this.score.toString())}};var game=new Phaser.Game(300,450,Phaser.AUTO,"game_cont");game.state.add("play",new Play),game.state.start("play");